<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>Sylvain L. - Configuration d'un serveur Apache</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.6.0/css/all.css"/>
    <link rel="stylesheet" href="../assets/css/bulma.css"/>
    <link rel="stylesheet" href="../assets/css/index.css"/>
    <link rel="icon shortcut" href="../assets/images/logo.png"/>
</head>
<body>
    <!-- Notification de changement de thème -->
    <div class="theme-notif"></div>

    <!-- Bouton pour changer de thème -->
    <button class="switch-btn"></button>

    <!-- Bouton retourner à l'accueil -->
    <a href="/" class="home-btn"><i class="fa-solid fa-home"></i></a>

    <!-- Titre de la page -->
    <section class="section">
        <div class="container">
            <div class="content">
                <h1 class="title">Apache - Configuration d'un serveur local</h1>
                <p class="subtitle">Guide simple pour configurer un serveur Apache 2 local.</p>
            </div>
        </div>
    </section>

    <!-- Installer les paquets -->
    <section class="section">
        <div class="container">
            <div class="content">
                <h2>Installation d'Apache2</h2>
                <div class="box">
                    <p>Installez Apache2 :</p>
                    <pre><code class="is-unselectable">$ </code>sudo apt install apache2</pre>
                    <pre>
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
    apache2-bin apache2-data apache2-utils ssl-cert
Suggested packages:
    www-browser
The following NEW packages will be installed:
    apache2 apache2-bin apache2-data apache2-utils ssl-cert
0 upgraded, 5 newly installed, 0 to remove and 0 not upgraded.
Need to get 1,120 kB/4,548 kB of archives.
After this operation, 20.0 MB of additional disk space will be used.
Do you want to continue? [Y/n] Y

Get:1 http://packages.linuxmint.com una/main amd64 apache2-bin amd64 2.4.41-4ubuntu3.16 [438 kB]
Get:2 http://packages.linuxmint.com una/main all apache2-data all 2.4.41-4ubuntu3.16 [162 kB]
Get:3 http://packages.linuxmint.com una/main amd64 apache2 amd64 2.4.41-4ubuntu3.16 [95.3 kB]
Get:4 http://packages.linuxmint.com una/main amd64 apache2-utils amd64 2.4.41-4ubuntu3.16 [98.6 kB]
Get:5 http://packages.linuxmint.com una/main all ssl-cert all 1.0.39 [15.2 kB]
Fetched 1,120 kB in 1s (1,298 kB/s)
Selecting previously unselected package apache2-bin.
(Reading database ... 200000 files and directories currently installed.)
Preparing to unpack .../apache2-bin_2.4.41-4ubuntu3.16_amd64.deb ...
Unpacking apache2-bin (2.4.41-4ubuntu3.16) ...
Selecting previously unselected package apache2-data.
Preparing to unpack .../apache2-data_2.4.41-4ubuntu3.16_all.deb ...
Unpacking apache2-data (2.4.41-4ubuntu3.16) ...
Selecting previously unselected package apache2-utils.
Preparing to unpack .../apache2-utils_2.4.41-4ubuntu3.16_amd64.deb ...
Unpacking apache2-utils (2.4.41-4ubuntu3.16) ...
Selecting previously unselected package ssl-cert.
Preparing to unpack .../ssl-cert_1.0.39_all.deb ...
Unpacking ssl-cert (1.0.39) ...
Selecting previously unselected package apache2.
Preparing to unpack .../apache2_2.4.41-4ubuntu3.16_amd64.deb ...
Unpacking apache2 (2.4.41-4ubuntu3.16) ...
Setting up apache2-bin (2.4.41-4ubuntu3.16) ...
Setting up apache2-data (2.4.41-4ubuntu3.16) ...
Setting up ssl-cert (1.0.39) ...
Setting up apache2-utils (2.4.41-4ubuntu3.16) ...
Setting up apache2 (2.4.41-4ubuntu3.16) ...
Enabling module mpm_event.
Enabling module authn_core.
Enabling module authz_core.
Enabling module access_compat.
Enabling module auth_basic.
Enabling module reqtimeout.
Enabling module filter.
Enabling module mime.
Enabling module log_config.
Enabling module env.
Enabling module headers.
Enabling module setenvif.
Enabling module version.
Enabling module unixd.
Enabling module status.
Enabling module autoindex.
Enabling module negotiation.
Enabling module dir.
Enabling module alias.
Enabling module rewrite.
Enabling conf charset.
Enabling conf localized-error-pages.
Enabling conf other-vhosts-access-log.
Enabling conf security.
Enabling conf serve-cgi-bin.
Enabling site 000-default.
    * Starting Apache httpd web server apache2
    *
Processing triggers for systemd (245.4-4ubuntu3.20) ...
Processing triggers for man-db (2.9.1-1) ...</pre>
                    <p>Pour lancer le serveur, effectuez les commandes suivantes :</p>
                    <pre><code class="is-unselectable">$ </code>systemctl start apache2</pre>

                    <p>Pour tester l'installation, accédez à l'adresse IP de la machine via un navigateur.</p>
                    <pre><code class="is-unselectable">$ </code>ip a</pre>

                    <p>Arborescence des fichiers d'Apache :</p>
                    <ul>
                        <li><code>/usr/sbin/apache2</code> : Exécutable principal</li>
                        <li><code>/etc/apache2</code> : Fichiers de configuration</li>
                        <li><code>/usr/share/apache2</code> : Fichiers partagés</li>
                    </ul>

                    <p>Vérifiez et gérez les modules MPM :</p>
                    <pre>a2query -M</pre>
                    <pre>mpm_event_module (static)</pre>

                    <p>Pour activer ou désactiver des modules :</p>
                    <pre>a2enmod [nom_du_module]</pre>
                    <pre>a2dismod [nom_du_module]</pre>

                    <p>Redémarrez Apache :</p>
                    <pre><code class="is-unselectable">$ </code>sudo systemctl restart apache2</pre>
                    <pre>[sudo] password for user: ***************</pre>
                </div>
            </div>
        </div>
    </section>

    <!-- Sécuriser le serveur Apache -->
    <section class="section">
        <div class="container">
            <div class="content">
                <h2>Sécurisation d'Apache2</h2>
                <div class="box">
                    <p>Modifiez le fichier <code>/etc/apache2/conf-enabled/security.conf</code> pour masquer la version et l'OS :</p>
                    <pre>ServerTokens Prod
ServerSignature Off</pre>

                    <p>Activez SSL :</p>
                    <pre><code class="is-unselectable">$ </code>sudo a2enmod ssl</pre>
                    <pre>Enabling module ssl.</pre>

                    <p>Générez un certificat autosigné :</p>
                    <pre><code class="is-unselectable">$ </code>sudo make-ssl-cert generate-default-snakeoil</pre>
                    <pre>
Generating a 2048 bit RSA private key
....................+++++
....................+++++
writing new private key to '/etc/ssl/private/ssl-cert-snakeoil.key'
                    </pre>

                    <p>Après cela, configurez le fichier <code>/etc/apache2/sites-available/sitka.conf</code> pour activer HTTPS :</p>
                    <pre>
&lt;VirtualHost *:443&gt;
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/sitka
    ServerName www.sitka.com

    SSLEngine on
    SSLCertificateFile      /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key
&lt;/VirtualHost&gt;</pre>

                    <p>Enfin, activez le site HTTPS :</p>
                    <pre><code class="is-unselectable">$ </code>sudo a2ensite sitka-ssl.conf</pre>
                    <pre>
Enabling site sitka-ssl.
To activate the new configuration, you need to run:
systemctl reload apache2</pre>

                    <p>Redémarrez Apache pour appliquer les changements :</p>
                    <pre><code class="is-unselectable">$ </code>sudo systemctl restart apache2</pre>
                    <pre>[sudo] password for user: ***************</pre>

                    <p>Sécurisez les répertoires en configurant des directives <code>&lt;Directory&gt;</code> dans vos hôtes virtuels et en créant un fichier <code>.htaccess</code> pour des règles spécifiques.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Utilisation de PHP -->
    <section class="section">
        <div class="container">
            <div class="content">
                <h2>Utilisation de PHP avec Apache2</h2>
                <div class="box">
                    <p>Pour utiliser PHP avec Apache2, vous pouvez l'installer de deux manières :</p>
                    <ul>
                        <li><strong>Méthode 1 :</strong> <code>libapache2-mod-php</code></li>
                        <li><strong>Méthode 2 :</strong> <code>php-fpm</code> (préférée)</li>
                    </ul>

                    <p>Configurez ensuite <code>sitka.conf</code> pour utiliser PHP avec FastCGI :</p>
                    <pre>
&lt;FilesMatch \.php$&gt;
    SetHandler "proxy:unix:/var/run/php/php7.4-fpm.sock|fcgi://localhost"
&lt;/FilesMatch&gt;</pre>

                    <p>Activez les modules nécessaires :</p>
                    <pre><code class="is-unselectable">$ </code>sudo a2enmod proxy_fcgi setenvif</pre>
                    <pre>
Enabling module proxy_fcgi.
Enabling module setenvif.</pre>
                </div>
            </div>
        </div>
    </section>

    <!-- Configurer les Virtual Hosts -->
    <section class="section">
        <div class="container mb-6">
            <div class="content">
                <h2>Création d'Hôtes Virtuels</h2>
                <div class="box">
                    <p>Créez un répertoire pour votre site et un fichier <code>index.html</code>. Ensuite, configurez un hôte virtuel :</p>
                    <ul>
                        <li>Copiez et modifiez le fichier <code>000-default.conf</code>.</li>
                        <li>Ajoutez les directives <code>ServerName</code>, <code>ServerAlias</code> et <code>DocumentRoot</code>.</li>
                    </ul>

                    <p>Vérifiez la syntaxe de la configuration :</p>
                    <pre><code class="is-unselectable">$ </code>apachectl configtest</pre>
                    <pre>Syntax OK</pre>

                    <p>Activez l'hôte virtuel :</p>
                    <pre><code class="is-unselectable">$ </code>sudo a2ensite sitka.conf</pre>
                    <pre>
Enabling site sitka.
To activate the new configuration, you need to run:
  systemctl reload apache2</pre>

                    <p>
                        Pour configurer un hôte virtuel par adresse IP, ajoutez des adresses IP virtuelles et modifiez <code>sitka.conf</code> pour écouter une adresse spécifique.<br>
                        Pour changer le port par défaut, modifiez <code>Listen</code> et <code>&lt;VirtualHost&gt;</code> dans <code>sitka.conf</code>.
                    </p>
                    <p>Redémarrez Apache :</p>
                    <pre><code class="is-unselectable">$ </code>sudo systemctl restart apache2</pre>
                    <pre>[sudo] password for user: ***************</pre>
                </div>
            </div>
        </div>
    </section>

    <!-- Bas de page -->
    <div class="has-text-centered p-4 bottom">
        <p><strong>
            <a href="/">sylvain.pro</a> &copy; 2024. Tous droits réservés.
        </strong></p>
    </div>

    <!-- Charger le Js -->
    <script type="text/javascript" src="../assets/js/theme.js"></script>
</body>
</html>
